import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as s}from"./components-QUucBwvO.js";import{A as R}from"./AccountLayout-DVVnIJUO.js";import{u as S}from"./AuthContext--VGCxBXt.js";import{Y as P,I as A,k as L}from"./lib-CLqVOKWi.js";import{u as T,a as I}from"./zod-BgOlUoe_.js";import{B as C}from"./Button-7Woa2p3a.js";import{I as O}from"./Input-je0LWCVA.js";import{o as W,s as k}from"./types-DBTFAyTi.js";import{f as D,g as F}from"./css-CVxtJxAn.js";import{u as V}from"./NotificationContext-zGujb8NW.js";import{u as B}from"./OperationContext-C6xAhjBF.js";import{P as U}from"./ProfileContentLayout-DfiaADyd.js";import{L as Y}from"./LoadingMessage-BIfhbO4x.js";import"./AccountUserImage-BEV8GVnp.js";import"./HomeNav-BRE81CFr.js";import"./MainNav-Bwxk1TUR.js";import"./index-CTKWte8j.js";import"./BusinessMenu-DlchWiv1.js";const H=W({email:k({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),J=({loaderData:n,user:t})=>{var w;const[l,d]=s.useState(null),[o,m]=s.useState(!1);V();const r=S();if(!r)return null;const{showOperation:f,showError:u,completeOperation:a,showSuccess:p}=B(),j=g=>{let h=g.target.value,x=g.target.name;d(c=>({...c,[x]:h}))},y=async g=>{var c;m(!0),f("processing","Sending reset password email"),await new Promise(i=>setTimeout(i,1e3));const x={email:(c=r==null?void 0:r.user)==null?void 0:c.email.trim()};try{const i=await r.resetpw(x);JSON.stringify(i).includes("Error")?(m(!1),u("Error",P(i)),a()):(p("Success",P(i)),a(),await new Promise(N=>setTimeout(N,1e3)),m(!1))}catch{u("Error","Password reset failed. Wait for a minute and retry."),a()}},{register:E,handleSubmit:b,getValues:M,setValue:$,watch:q,setError:z,formState:{errors:v,isSubmitting:G}}=T({defaultValues:n.userProfile,resolver:I(H)});return e.jsx("form",{onSubmit:b(y),children:e.jsx("div",{className:`${D} mt-0  
                        rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:F,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Reset Password"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsx("b",{children:(w=n.userProfile)==null?void 0:w.email})," is your current email. It will be used be used for password resets or changes."]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(O,{controlTitle:"Your Email Address",controlPlaceholder:"Retype new password",controlName:"email",controlType:"text",disabled:!0,register:E,changeHandler:j,error:v.email}),e.jsx(C,{working:o,value:"Send Reset Email"})]})})})},pe=()=>{s.useEffect(()=>{A(localStorage)},[]);const n=S();if(!n)return null;const{user:t}=n,[l,d]=s.useState(null),[o,m]=s.useState(null),[r,f]=s.useState(!0);return s.useEffect(()=>{async function u(a){const p=await L(a||"");d(p)}try{t!=null&&t.guid&&u(t==null?void 0:t.guid)}catch(a){console.log(a.message)}},[t==null?void 0:t.guid]),s.useEffect(()=>{l&&m({userProfile:l})},[l]),s.useEffect(()=>{o&&f(!1)},[o]),r?e.jsx(Y,{loading:r}):e.jsx(R,{children:e.jsxs(U,{title:"Reset Password",children:[l===null?"Loading...":"",o&&e.jsx(J,{loaderData:o,user:t})]})})};export{pe as default};
